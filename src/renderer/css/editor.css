.page {
    position: absolute;
    top: 32px;
    left: 0;
    right: 0;
    bottom: 0;
    opacity: 0;
    transition: opacity 0.4s ease-in-out;
    pointer-events: none;
    display: flex;
    flex-direction: column;
}
.page.active {
    opacity: 1;
    pointer-events: auto;
}
#editor-page {
    justify-content: flex-start; /* Align content to the top */
    padding-top: 50px; /* ADDED: Make space for the absolute header */
}

/* CHANGED: Styles for the empty page hint */
.empty-page-hint {
    background-color: #e81123;
    color: white;
    padding: 8px 15px;
    border-radius: 5px;
    font-size: 0.9rem;
    font-weight: bold;
    z-index: 5;
    display: none; /* Hidden by default */
    margin-bottom: 1rem;
}

.empty-page-hint.visible {
    display: inline-block;
}


/* Styles for pages with centered content */
.centered-content {
    width: 100%;
    margin: auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}
.editor-menu {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    align-items: center;
}
.editor-menu-btn {
    width: 250px;
    padding: 1rem 2rem;
    font-size: 1.2rem;
    border: 1px solid #555;
    border-radius: 5px;
    background-color: #4a4a4a;
    color: #fff;
    cursor: pointer;
    transition: all 0.3s ease;
}
.editor-menu-btn:hover {
    background-color: #5a5a5a;
    border-color: #777;
}

.editor-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 50px;
    background-color: #252526;
    border-bottom: 1px solid #444;
    padding: 0 0.5rem;
    flex-shrink: 0;
    gap: 1rem;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    z-index: 950;
}
.header-actions, .header-actions-right {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex: 1;
    height: 70%;
}
.header-actions-right {
    justify-content: flex-end;
}
.header-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    background-color: #3c3c3c;
    border: 1px solid #555;
    color: #ccc;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s, opacity 0.2s;
}
.header-btn:hover {
    background-color: #4a4a4a;
    border-color: #777;
}

/* ADDED: Style for disabled header buttons, including playback controls */
.header-btn:disabled,
.header-btn:disabled:hover {
    opacity: 0.4;
    cursor: not-allowed;
    background-color: #3c3c3c;
    border-color: #555;
}

/* --- ADDED: Header Divider --- */
.header-divider {
    width: 1px;
    height: 24px;
    background-color: #444;
}

.header-btn-icon {
    width: 18px;
    height: 18px;
}
.header-btn-icon svg, .header-btn-icon img,
.playback-controls .header-btn img {
    width: 100%;
    height: 100%;
}

/* --- NEW: Editor Menubar Styles --- */
.menubar {
    display: flex;
    align-items: center;
    height: 100%;
}

.menu-item {
    position: relative;
    height: 100%;
}

.menu-btn {
    height: 100%;
    padding: 0 12px;
    background-color: transparent;
    border: none;
    border-radius: 3px;
    color: #ccc;
    cursor: pointer;
    transition: background-color 0.2s;
    font-size: 0.9rem;
}

.menu-btn:hover, .menu-item.open .menu-btn {
    background-color: #3c3c3c;
}

.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    min-width: 240px;
    background-color: #252526;
    border: 1px solid #444;
    border-top: none;
    border-radius: 0 0 5px 5px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    padding: 5px 0;
    z-index: 1000;
    display: none; /* Hidden by default */
}

.menu-item.open .dropdown-menu {
    display: block;
}

.dropdown-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 12px;
    color: #ccc;
    text-decoration: none;
    font-size: 0.9rem;
    white-space: nowrap;
    transition: background-color 0.2s, color 0.2s;
}

.dropdown-item:hover {
    background-color: #007bff;
    color: #fff;
}

.dropdown-item.disabled {
    color: #666;
    pointer-events: none;
    background-color: transparent;
}

.dropdown-divider {
    height: 1px;
    margin: 5px 0;
    background-color: #444;
    border: none;
}

/* --- NEW: Menubar Item Content Styles --- */
.dropdown-item-icon {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
}

.dropdown-item-label {
    flex-grow: 1;
}

.dropdown-item-shortcut {
    color: #888;
    font-size: 0.85rem;
}

.dropdown-item:hover .dropdown-item-shortcut {
    color: #ddd;
}

.dropdown-item.disabled .dropdown-item-icon {
    opacity: 0.5;
}

.dropdown-item.disabled .dropdown-item-shortcut {
    color: #555;
}


/* --- New Timeline / Playback Controls --- */
.timeline-container {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    height: 100%;
}

.timeline-bar {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 290px;
    height: 28px;
    background-color: #1e1e1e;
    border: 1px solid #555;
    border-radius: 4px;
    color: #ccc;
    font-size: 0.9rem;
    font-weight: bold;
    overflow: hidden;
}
.timeline-bar span {
    position: relative;
    z-index: 2;
}
.timeline-progress {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background-color: #007bff;
    border-radius: 3px;
    z-index: 1;
}

.playback-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.playback-controls .header-btn {
    width: 36px;
    height: 36px;
    padding: 8px;
    gap: 0;
    justify-content: center;
}
.playback-controls .header-btn img {
    width: 18px;
    height: 18px;
}
#play-pause-btn .pause-icon {
    display: none;
}
#play-pause-btn.is-playing .pause-icon {
    display: block;
}
#play-pause-btn.is-playing .play-icon {
    display: none;
}

.bpm-control {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #ccc;
}
#bpm-value-input {
    width: 60px;
    padding: 6px;
    font-size: 0.9rem;
    text-align: center;
}
.bpm-equals {
    font-weight: bold;
}

/* --- Custom Select Dropdown --- */
.custom-select-wrapper {
    position: relative;
    height: 36px;
    width: 60px;
}
.custom-select {
    height: 100%;
}
.select-selected {
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #3c3c3c;
    border: 1px solid #555;
    border-radius: 4px;
    height: 100%;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    padding-right: 15px; /* Space for arrow */
}
.select-selected:hover, .custom-select.select-active .select-selected {
    border-color: #777;
    background-color: #4a4a4a;
}
.select-selected::after { /* Custom dropdown arrow */
    content: 'â–¼';
    font-size: 10px;
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none;
    transition: transform 0.2s ease;
}
.custom-select.select-active .select-selected::after {
    transform: translateY(-50%) rotate(180deg);
}
.select-selected img {
    height: 22px;
    width: 22px;
}
.select-items {
    position: absolute;
    background-color: #3c3c3c;
    top: calc(100% + 5px);
    left: 0;
    right: 0;
    border: 1px solid #555;
    border-radius: 4px;
    overflow: hidden;
}
.select-items div {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 8px;
    cursor: pointer;
    transition: background-color 0.2s ease;
}
.select-items div:hover {
    background-color: #5a5a5a;
}
.select-items img {
    height: 22px;
    width: 22px;
}
.select-hide {
    display: none;
}

/* --- Editor Layout Styles --- */
.editor-layout {
    display: flex;
    flex-grow: 1;
    overflow: hidden;
}
/* --- Elements Panel (Left) --- */
.elements-panel, .events-panel {
    width: 240px;
    background-color: #252526;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    transition: width 0.3s ease-in-out;
    overflow: hidden;
    border-right: 1px solid #444;
}

.elements-panel.collapsed, .events-panel.collapsed {
    width: 0;
}
.drawer-header {
    padding: 0 1rem;
    height: 50px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #444;
    flex-shrink: 0;
    transition: background-color 0.2s;
}

.drawer-header.clickable {
    cursor: pointer;
}

.drawer-header.clickable:hover {
    background-color: #3c3c3c;
}

.drawer-collapse-icon {
    color: #ccc;
    font-size: 1.5rem;
    padding: 0;
    line-height: 1;
    transition: color 0.2s;
}
.drawer-header.clickable:hover .drawer-collapse-icon {
    color: #fff;
}

.drawer-header h3 {
    margin: 0;
    font-size: 1rem;
    white-space: nowrap;
}
.drawer-body {
    padding: 1rem;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 1rem;
}
.drawer-group h4 {
    color: #888;
    text-transform: uppercase;
    font-size: 0.8rem;
    margin: 0 0 1rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #444;
}
.drawer-element {
    display: flex;
    align-items: center;
    padding: 0.8rem;
    background-color: #3c3c3c;
    border-radius: 4px;
    cursor: grab;
    transition: background-color 0.2s;
    margin-bottom: 0.5rem;
}
.drawer-element:hover {
    background-color: #4a4a4a;
}
/* Style for element being dragged */
.drawer-element.dragging {
    opacity: 0.5;
}
.element-icon {
    width: 24px;
    height: 24px;
    margin-right: 12px;
    color: #ccc;
    flex-shrink: 0;
}
.element-icon svg, .element-icon img {
    width: 100%;
    height: 100%;
}
.element-label {
    font-size: 0.9rem;
    white-space: nowrap;
}

/* --- Music Elements List in Events Panel --- */
.music-elements-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.music-element-item {
    display: flex;
    align-items: center;
    padding: 0.8rem;
    background-color: #3c3c3c;
    border-radius: 4px;
    cursor: grab;
    transition: all 0.2s;
    margin-bottom: 0.5rem;
}

.music-element-item:hover {
    background-color: #4a4a4a;
}

.music-element-item.selected {
    background-color: rgba(0, 123, 255, 0.7);
    color: white;
}

.music-element-item.selected .element-icon {
    color: white;
}

.music-element-item .element-label {
    flex-grow: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.music-element-item.dragging {
    opacity: 0.4;
    border-style: dashed;
}

.music-element-item.drag-over-before {
    border-top: 2px solid #ff00e5;
}

.music-element-item.drag-over-after {
    border-bottom: 2px solid #ff00e5;
}

.measure-count {
    color: #888;
    font-size: 0.8rem;
    flex-shrink: 0;
    margin-left: 8px;
    font-style: italic;
}

.music-element-item:hover .measure-count,
.music-element-item.selected .measure-count {
    color: #ccc;
}

.total-measures-display {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #444;
    text-align: center;
    font-weight: bold;
    color: #ccc;
    font-size: 0.9rem;
    white-space: nowrap;
}


/* --- Drawer Handles --- */
.drawer-handle {
    width: 0;
    opacity: 0;
    overflow: hidden;
    background-color: #252526;
    flex-shrink: 0;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: width 0.2s ease-in-out, opacity 0.2s ease-in-out, background-color 0.2s;
}

.drawer-handle:hover {
    background-color: #3c3c3c;
}

.drawer-open-btn {
    background: none;
    border: none;
    color: #ccc;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0;
    line-height: 1;
}

/* Show handle when its preceding sibling drawer is collapsed */
#elements-panel-handle.visible,
#events-panel-handle.visible,
.properties-panel.collapsed + #properties-panel-handle,
.layers-panel.collapsed + #layers-panel-handle {
    width: 28px;
    opacity: 1;
}


/* --- Main Editor Area --- */
.main-editor-area {
    flex-grow: 1;
    padding: 2rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background-color: #2d2d2d;
    position: relative;
    overflow: hidden;
}

#slide-viewport-wrapper {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

/* REFACTORED: .presentation-slide is now the viewport */
.presentation-slide {
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    background-color: #000000;
    outline: 1px solid #444;
    position: absolute;
    top: 50%;
    left: 50%;
    overflow: hidden; /* This is the new clipping boundary */
}

/* NEW: Container that holds all page divs */
#page-container {
    width: 100%;
    height: 100%;
    position: relative;
}

/* NEW: Styles for individual page wrappers */
.slide-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: none; /* Pages are hidden by default */
    background-color: #1e1e1e;
    color: #fff;
    flex-direction: column;
    overflow: hidden;
    transform: translateZ(0); /* Promote to own rendering layer */
}

/* NEW: Class to make a page wrapper visible */
.slide-wrapper.visible {
    display: flex;
}

/* REMOVED: Old #page-root and #page-root-wrapper styles are replaced by .slide-wrapper */

/* Styles for the empty slide state */
.slide-wrapper.is-empty {
    outline: 2px dashed #555;
    justify-content: center;
    align-items: center;
}
.empty-slide-content {
    text-align: center;
    color: #777;
    font-size: 1.1rem;
    width: 100% !important;
    height: 100% !important;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.empty-slide-content p {
    margin: 0;
}

/* Styles for dropped containers */
.v-container, .h-container, .a-container, .placeholder-element {
    box-sizing: border-box;
}

.v-container, .h-container {
    display: flex;
    flex-grow: 1;
    min-height: 50px;
    min-width: 50px;
    gap: 8px;
    position: relative;
}
.v-container {
    flex-direction: column;
}
.h-container {
    flex-direction: row;
}
/* Placeholder text inside an empty container */
.container-placeholder {
    color: #666;
    font-size: 30px;
    text-align: center;
    margin: auto; /* This helps center it perfectly */
    position: absolute;   /* take it out of normal flow */
    top: 50%;             /* move top edge to 50% of parent */
    left: 50%;            /* move left edge to 50% of parent */
    transform: translate(-50%, -50%); /* shift it back by half its size */
}

/* When a container has content, align it to the start */
.v-container:not(.is-empty-container) {
    align-items: stretch; /* Make children take full width */
    justify-content: flex-start;
}
.h-container:not(.is-empty-container) {
    align-items: flex-start;
    justify-content: flex-start;
}
/* Placeholder for other dropped elements */
.placeholder-element {
    flex-shrink: 0; /* Prevent elements from shrinking inside a container */
    padding: 20px;
    text-align: center;
    color: #ccc;
    background-color: #3a3a3a;
    box-shadow: inset 0 0 0 1px #888;
}

/* Visual feedback for an invalid drag over */
.drag-invalid {
    background-color: rgba(232, 17, 35, 0.2) !important;
    box-shadow: inset 0 0 0 2px #e81123;
}

/* Ignore non-container elements as drop targets during a drag operation */
body.is-dragging .slide-wrapper [data-element-type]:not([data-element-type$="container"]) {
    pointer-events: none;
}

/* --- Drop Hint --- */
.drop-hint {
    position: fixed; /* Use fixed positioning */
    bottom: 20px; /* Position from the bottom of the viewport */
    left: 50%;
    transform: translateX(-50%);
    background-color: #e81123;
    color: white;
    padding: 10px 20px;
    border-radius: 5px;
    z-index: 2000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease-in-out;
    white-space: nowrap;
}
.drop-hint.visible {
    opacity: 1;
}
/* --- Right Panels (Properties & Layers) --- */
.properties-panel,
.layers-panel {
    width: 240px;
    background-color: #252526;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    transition: width 0.3s ease-in-out;
    overflow: hidden;
    border-left: 1px solid #444;
}

.properties-panel.collapsed,
.layers-panel.collapsed {
    width: 0;
}

.properties-body {
    padding: 1rem;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 0.5rem; /* Tighter gap between prop groups */
}

/* --- Properties Panel --- */
.prop-group {
    display: flex;
    flex-direction: column;
}

.form-group {
    margin-top: 0.5rem;
    gap: 0.3rem;
}

/* MODIFIED: Styles for event-controlled property groups */
.form-group.is-event-controlled,
.toggle-switch-container.is-event-controlled {
    background: #3c3c3c;
    padding: 3px;
    border: #24d7ff 1px solid;
    border-radius: 10px;
    margin-top: 5px; /* Add some margin to avoid visual clutter */
    margin-bottom: 5px;
    width: calc(100% - 8px); /* Adjust width to account for padding */
    cursor: not-allowed;
}

/* ADDED: A simpler disabled style for when a feature is just toggled off */
.controls-disabled {
    pointer-events: none;
    opacity: 0.6;
}

.prop-group-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #888;
    text-transform: uppercase;
    font-size: 0.8rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #444;
}

/* Make only the title and toggle button appear clickable */
.prop-group-header h4,
.prop-toggle-btn {
    cursor: pointer;
}

/* Style the title (h4) on its own hover */
.prop-group-header h4 {
    margin: 0;
    font-weight: bold;
    transition: color 0.2s; /* Add transition here */
}
.prop-group-header h4:hover {
    color: #fff; /* Change color only when hovering the text */
}

.prop-group-header-buttons {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.prop-toggle-btn, .prop-reset-btn, .prop-lock-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 2px;
    display: flex;
    align-items: center;
    border-radius: 3px;
    transition: all 0.2s;
}

.prop-toggle-btn:hover img, .prop-reset-btn:hover img, .prop-lock-btn:hover img.icon-unlocked {
    filter: brightness(1000%);
}

.prop-reset-btn:hover, .prop-lock-btn:hover, .prop-toggle-btn:hover {
    color: #fff;
}

.prop-toggle-btn svg, .prop-reset-btn svg, .prop-lock-btn svg, .prop-toggle-btn img, .prop-reset-btn img, .prop-lock-btn img {
    width: 16px;
    height: 16px;
}
.prop-toggle-btn {
    transition: transform 0.3s ease-in-out;
}
.prop-group.collapsed .prop-toggle-btn {
    transform: rotate(-90deg);
}

.prop-lock-btn .icon-unlocked { display: none; }
.prop-lock-btn .icon-locked { display: block; }
.prop-lock-btn.is-unlocked .icon-unlocked { display: block; }
.prop-lock-btn.is-unlocked .icon-locked { display: none; }

.prop-group-body {
    display: grid;
    gap: 1rem;
    overflow: hidden;
    max-height: 1000px; /* Large value for expanded state */
    transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out, padding 0.3s ease-in-out;
    opacity: 1;
    margin: 0 0 1rem;
}

#properties-dialog .prop-group.collapsed .prop-group-body {
    padding: 0 1rem;
}

.prop-group.collapsed .prop-group-body {
    max-height: 0;
    opacity: 0;
}


.segmented-tabs {
    display: flex;
    justify-content: space-between;
    background-color: #333;
    border-radius: 5px;
    padding: 3px;
}
.segmented-tabs .tab-btn {
    flex: 1;
    padding: 0.4rem 0;
    border-radius: 4px;
    border: none;
    background-color: transparent;
    color: #aaa;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.85rem;
}

.segmented-tabs .tab-btn img {
    width: 18px;
    height: 18px;
    vertical-align: middle;
    margin-right: 6px;
}

.segmented-tabs .tab-btn:hover:not(.active):not(:disabled) {
    background-color: #4a4a4a;
}
.segmented-tabs .tab-btn.active {
    background-color: #5a5a5a;
    color: #fff;
}
.segmented-tabs .tab-btn:disabled {
    color: #666;
    cursor: not-allowed;
}

.tab-content { display: none; }
.tab-content.active {
    display: grid;
    gap: 1rem;
}

.input-with-unit {
    display: flex;
    gap: 0.5rem;
}

.input-with-unit .form-input {
    flex-grow: 1;
}

.input-with-unit .form-select {
    flex-shrink: 0;
    width: auto;
    min-width: 60px;
}

.input-with-unit .unit-label {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    color: #aaa;
}

/* 1. Constrain the input-with-button container */
.input-with-button {
    display: flex;
    flex-direction: column; /* Stack vertically */
    align-items: stretch;    /* Fill width */
    gap: 0.5rem;
    width: 100%;             /* Occupy full parent width */
    max-width: 100%;         /* Strictly forbid expanding parent */
    min-width: 0;            /* The "Magic Fix": allows flex items to shrink below content size */
    box-sizing: border-box;
}

/* 2. Fix the filename span */
.input-with-button .readonly-input {
    color: #ccc;
    border: 1px solid #555;
    background-color: #333;
    padding: 6px 12px;
    font-size: 13px;

    /* Text Truncation Logic */
    white-space: nowrap;     /* Keep on one line */
    overflow: hidden;        /* Hide the overflow */
    text-overflow: ellipsis; /* Add "..." */

    display: block;          /* Block ensures it respects width: 100% */
    width: 100%;
    max-width: 100%;
    height: 38.5px;
    box-sizing: border-box;
    line-height: 24px;       /* Center text vertically */
    cursor: default;
    border-radius: 4px;
}

/* 3. Ensure the Choose button also stays in bounds */
.input-with-button button {
    width: 100%;
    margin-top: 0 !important; /* Remove the old margin hack */
    box-sizing: border-box;
}

/* 4. Global Fix for the Properties Panel groups */
/* This ensures the entire form group doesn't expand because of its children */
.prop-group-body .form-group {
    min-width: 0;
    max-width: 100%;
}

.spacing-grid, .padding-grid, .gravity-grid {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.color-picker-container {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.color-swatch {
    width: 100%;
    height: 40px;
    border: 1px solid #555;
    border-radius: 5px;
    cursor: pointer;
    background-image: linear-gradient(45deg, #808080 25%, transparent 25%), linear-gradient(-45deg, #808080 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #808080 75%), linear-gradient(-45deg, transparent 75%, #808080 75%);
    background-size: 20px 20px;
    background-position: 0 0, 0 10px, 10px -10px, -10px 0;
    box-sizing: border-box;
}
.color-swatch-inner {
    width: 100%;
    height: 100%;
    border-radius: 4px; /* Slightly smaller than parent */
}


.gradient-picker-placeholder {
    padding: 2rem;
    text-align: center;
    color: #777;
    border: 2px dashed #444;
    border-radius: 5px;
}

.gradient-preview {
    width: 100%;
    height: 40px;
    border: 1px solid #555;
    border-radius: 5px;
    cursor: pointer;
    box-sizing: border-box;
}

/* --- Toggle Switch --- */
.toggle-switch-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    gap: 1rem;
}
.toggle-switch-container .form-group {
    margin-bottom: 0; /* Override default form-group margin */
}
.toggle-switch {
    position: relative;
    display: inline-block;
    width: 44px;
    height: 24px;
    flex-shrink: 0;
}
.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}
.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #555;
    transition: .4s;
    border-radius: 24px;
}
.toggle-slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}
input:checked + .toggle-slider {
    background-color: #007bff;
}
input:checked + .toggle-slider:before {
    transform: translateX(20px);
}


/* --- Layers Panel Specific Styles --- */
.layer-tree, .layer-children {
    list-style: none;
    margin: 0;
    padding: 0;
    font-size: 0.9rem;
    color: #ccc;
}

.layer-tree {
    position: relative;
}

.layer-children {
    padding-left: 18px; /* Compact indentation */
}

.layer-item {
    position: relative;
    pointer-events: none;
    margin-top: 3px;
}

.layer-item > * {
    pointer-events: auto;
}

/* Vertical tree line */
.layer-item::before {
    content: '';
    position: absolute;
    top: -3px;
    left: 2px;
    width: 1px;
    height: calc(100% + 3px);
    background-color: #444;
}

/* Horizontal tree line */
.layer-item::after {
    content: '';
    position: absolute;
    top: 14px;
    left: 2px;
    width: 10px;
    height: 1px;
    background-color: #444;
}

/* Stop the vertical line for the last item in a group */
.layer-item:last-child::before {
    height: calc(14px + 3px);
}

/* Root items don't need lines */
.layer-tree > .layer-item::before,
.layer-tree > .layer-item::after {
    display: none;
}

.layer-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-radius: 4px;
    margin-left: 16px;
    transition: background-color 0.15s ease-in-out;
}

.layer-tree > .layer-item > .layer-content {
    margin-left: 0;
}

.layer-item > .layer-content:hover {
    background-color: #3c3c3c;
}

.layer-toggle-btn {
    background: none;
    border: none;
    color: #888;
    cursor: pointer;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 28px;
    flex-shrink: 0;
    transition: transform 0.2s ease-in-out;
}
.layer-toggle-btn.is-hidden {
    visibility: hidden;
}
.layer-item.collapsed > .layer-content .layer-toggle-btn {
    transform: rotate(-90deg);
}

/* Highlight effect for layer items when clicked from the events panel */
.layer-item.highlight-from-events > .layer-content {
    background-color: rgba(123, 255, 0, 0.4);
}

.layer-item > .layer-content {
    transition: background-color 0.2s ease-out; /* Slow fade out for the highlight */
}

.layer-info {
    display: flex;
    align-items: center;
    gap: 6px;
    flex-grow: 1;
    overflow: hidden;
    padding: 0 4px;
    min-width: 0;
}

.layer-type-icon {
    width: 16px;
    height: 16px;
    color: #888;
    flex-shrink: 0;
}
.layer-type-icon svg, .layer-type-icon img {
    width: 100%;
    height: 100%;
}

.layer-name {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.layer-actions {
    display: none;
    align-items: center;
    gap: 4px;
    padding-right: 8px;
    flex-shrink: 0;
}

.layer-content:hover .layer-actions {
    display: flex;
}

.layer-action-btn {
    background: none;
    border: none;
    color: #aaa;
    cursor: pointer;
    padding: 4px;
    border-radius: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s, color 0.2s;
}
.layer-action-btn:hover {
    background-color: #555;
    color: #fff;
}
.layer-action-btn svg, .layer-action-btn img {
    width: 16px;
    height: 16px;
}

/* --- NEW: Styles for Layer Visibility Button --- */
.layer-visibility-btn {
    padding: 2px;
}

.layer-visibility-btn .icon-hidden { display: none; }
.layer-visibility-btn .icon-visible { display: block; }

.layer-visibility-btn.is-hidden .icon-hidden { display: block; }
.layer-visibility-btn.is-hidden .icon-visible { display: none; }

.layer-visibility-btn:disabled {
    cursor: not-allowed;
    opacity: 0.5;
}

.layer-visibility-btn:disabled:hover {
    background-color: transparent;
    color: #aaa;
}

/* Collapse/Expand Logic */
.layer-item.collapsed > .layer-children {
    display: none;
}

/* --- Orchestra Progress Bar --- */
.orchestra-progress-container {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    box-sizing: border-box;
    color: #ccc;
}

.orchestra-progress-bar {
    width: calc(100% - 2px);
    height: 20px;
    background-color: #3c3c3c;
    border: 1px solid #555;
    border-radius: 6px;
    overflow: hidden;
}

.orchestra-progress-fill {
    height: 100%;
    background-color: #007bff;
    border-radius: 6px;
}

/* --- Page Manager (Bottom) --- */
.page-manager {
    min-height: 100px; /* Use min-height to allow the container to grow */
    background-color: #252526;
    border-top: 1px solid #444;
    display: flex;
    align-items: center;
    padding: 0 1rem;
    gap: 1rem;
    flex-shrink: 0;
    overflow-x: auto; /* ADDED */
    overflow-y: hidden; /* ADDED to prevent vertical scrollbar */
}
.page-thumbnails-container {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: nowrap; /* ADDED to ensure it stays in one line */
}
.page-thumbnail {
    position: relative;
    width: 120px;
    height: 70px;
    background-color: #3c3c3c;
    border: 2px solid #555;
    border-radius: 4px;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    color: #ccc;
    cursor: pointer;
    flex-shrink: 0;
    transition: all 0.2s;
}
.page-thumbnail:hover {
    border-color: #777;
}
.page-thumbnail.active-page {
    border-color: #007bff;
    background-color: #2c3e50;
}
.page-thumbnail .page-number {
    font-size: 16px;
    font-weight: bold;
    color: #fff;
}

.page-thumbnail .page-name {
    max-width: 90px; /* Adjust as needed */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-size: 13px;
    color: #fff;
    margin-top: 4px;
}
.delete-page-btn, .duplicate-page-btn {
    position: absolute;
    top: -6px;
    width: 20px;
    height: 20px;
    color: white;
    border: 1px solid #1e1e1e;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    opacity: 0;
    transform: scale(0.8);
    transition: opacity 0.2s ease, transform 0.2s ease;
    z-index: 10;
    padding: 0;
}

.delete-page-btn {
    right: -6px;
    background-color: #cc3333;
    font-size: 14px;
    line-height: 20px;
}

.duplicate-page-btn {
    right: 18px;
    background-color: #007bff;
}

.duplicate-page-btn img {
    width: 10px;
    height: 10px;
}

.page-thumbnail:hover .delete-page-btn,
.page-thumbnail:hover .duplicate-page-btn {
    opacity: 1;
    transform: scale(1);
}
.delete-page-btn:hover {
    background-color: #e81123;
    transform: scale(1.1);
}

.duplicate-page-btn:hover {
    background-color: #0056b3;
    transform: scale(1.1);
}

.add-page-btn, .add-measure-btn {
    width: 70px;
    height: 70px;
    background-color: transparent;
    border: 2px dashed #555;
    border-radius: 4px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 2rem;
    color: #ccc;
    cursor: pointer;
    transition: all 0.2s;
    flex-shrink: 0;
}

.add-measure-btn {
    margin-left: 0.5rem;
}
.add-page-btn:hover, .add-measure-btn:hover {
    background-color: #3c3c3c;
    border-color: #777;
}
.no-selection {
    -webkit-touch-callout: none; /* iOS Safari */
    -webkit-user-select: none; /* Safari */
    -khtml-user-select: none; /* Konqueror HTML */
    -moz-user-select: none; /* Old versions of Firefox */
    -ms-user-select: none; /* Internet Explorer/Edge */
    user-select: none; /* Non-prefixed version, currently supported by Chrome, Edge, Opera and Firefox */
}

/* --- Styles for Thumbnail Page --- */
.page-thumbnail.thumbnail-page {
    cursor: pointer;
}

.page-thumbnail.thumbnail-page.active-page {
    border-color: #ffaa00;
    background-color: #5a5140;
}

.page-thumbnail.thumbnail-page:hover {
    border-color: #b98b33;
}

.page-thumbnail.thumbnail-page .page-name {
    font-size: 14px;
    font-weight: bold;
}

.page-manager-divider {
    width: 2px;
    height: 60px;
    background-color: #444;
    border-radius: 1px;
    flex-shrink: 0;
}


/* --- Styles for Page Reordering --- */
.page-thumbnail.dragging-page {
    opacity: 0.4;
    border-style: dashed;
}

.page-thumbnail.drag-over-left::before,
.page-thumbnail.drag-over-right::after {
    content: '';
    position: absolute;
    top: -4px;
    bottom: -4px;
    width: 4px;
    background-color: #007bff;
    border-radius: 2px;
    z-index: 1;
}

.page-thumbnail.drag-over-left::before {
    left: -8px;
}

.page-thumbnail.drag-over-right::after {
    right: -8px;
}

/* --- Layers Panel Drag & Drop Styles --- */
.layer-item.dragging-layer {
    opacity: 0.5;
}

/* Style for the visual drop indicator (before/after) */
.layer-item > .layer-content.drag-over-before {
    border-top: 2px solid #ff00e5;
}
.layer-item > .layer-content.drag-over-after {
    border-bottom: 2px solid #ff00e5;
}

/* Style for the visual drop indicator (inside/nesting) */
.layer-item > .layer-content.drag-over-inside {
    background-color: rgba(0, 123, 255, 0.2);
}

/* Prevent pointer events on children during drag to make target detection easier */
.layer-item.dragging-layer * {
    pointer-events: none;
}

/* --- AContainer & Absolute Page Styles --- */
.a-container {
    position: relative;
    min-height: 50px;
    min-width: 50px;
}

.slide-wrapper > *,
.a-container > * {
    position: absolute;
    top: 0;
    left: 0;
    width: 50%;
    height: 50%;
}

.slide-wrapper > .v-container,
.slide-wrapper > .h-container,
.slide-wrapper > .a-container,
.a-container > .v-container,
.a-container > .h-container,
.a-container > .a-container {
    flex-grow: 1;
}

/* --- Layer & Element Selection/Highlight Styles --- */

/* Style for the selected layer in the Layers Panel */
.layer-item.selected > .layer-content {
    background-color: rgba(0, 123, 255, 0.7);
    color: white;
}

.layer-item.selected > .layer-content .layer-type-icon,
.layer-item.selected > .layer-content .layer-toggle-btn {
    color: white;
}

/* Temporary hover effect for elements on the slide */
.element-hovered {
    box-shadow: inset 0 0 0 1px #038800;
}

/* Highlight effect for elements on the slide when selected in the Layers Panel */
.element-highlighted {
    box-shadow: inset 0 0 0 2px #007bff !important;
    pointer-events: none;
}

[data-element-type] {
    transition: box-shadow 0.2s ease-in-out;
}

/* --- Custom Dialog Styles --- */
.dialog-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    display: flex; /* Always a flex container now */
    justify-content: center;
    align-items: center;
    z-index: 1000;
    /* --- CHANGES FOR FADE EFFECT --- */
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease-in-out;
}
.dialog-overlay.visible {
    /* --- CHANGES FOR FADE EFFECT --- */
    opacity: 1;
    pointer-events: auto;
}
.dialog-content {
    background-color: #3c3c3c;
    border: 1px solid #555;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    color: #fff;
    font-size: 0.9rem;
    max-width: min(650px, 80vw);
    /* --- CHANGES FOR POP-IN EFFECT --- */
    transform: scale(0.95);
    opacity: 0;
    transition: transform 0.25s ease-in-out, opacity 0.25s ease-in-out;
}

/* --- ADDED: Rule for content animation when visible --- */
.dialog-overlay.visible .dialog-content {
    transform: scale(1);
    opacity: 1;
}

.dialog-header {
    padding: 0.8rem 1rem;
    border-bottom: 1px solid #555;
    font-weight: bold;
}
.dialog-body {
    padding: 1rem;
}
.dialog-body p {
    margin: 0;
    line-height: 1.5;
    word-wrap: break-word;
}
.dialog-footer {
    padding: 0.8rem 1rem;
    border-top: 1px solid #555;
    display: flex;
    justify-content: flex-end;
    gap: 0.8rem;
}
.dialog-footer .action-btn {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
}

/* ADDED: Style for the new "Inherit" button */
.dialog-footer .inherit-btn {
    background-color: #55a521; /* A distinct warning/yellow color */
    color: #fff;
    border: none;
    margin-right: auto; /* Push it to the left */
}
.dialog-footer .inherit-btn:hover {
    background-color: #6fcf3f;
}

/* --- Custom Color Picker Styles --- */
#ocp-bottom-inputs {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    align-items: center;
}

.color-picker-main {
    display: flex;
    gap: 1rem;
    flex-grow: 1;
}
.color-picker-layout {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}
.color-picker-top {
    display: flex;
    gap: 1rem;
}
.color-picker-sv-panel {
    width: 256px;
    height: 256px;
    position: relative;
    cursor: crosshair;
    border: 1px solid #555;
}
.color-picker-sv-panel::before,
.color-picker-sv-panel::after {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
}
.color-picker-sv-panel::before {
    background: linear-gradient(to right, white, rgba(255, 255, 255, 0));
}
.color-picker-sv-panel::after {
    background: linear-gradient(to top, black, rgba(0, 0, 0, 0));
}

.color-picker-sv-panel .color-picker-selector {
    position: absolute;
    width: 10px;
    height: 10px;
    border: 2px solid white;
    border-radius: 50%;
    box-shadow: 0 0 0 1.5px black, inset 0 0 0 1.5px black;
    transform: translate(-50%, -50%);
    pointer-events: none;
    z-index: 2;
}
.color-picker-hue-slider, .color-picker-alpha-slider {
    width: 24px;
    height: 256px;
    position: relative;
    cursor: pointer;
    border: 1px solid #555;
}
.color-picker-hue-slider {
    background: linear-gradient(to bottom, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);
}
.color-picker-alpha-slider {
    /* This is a placeholder that JS overwrites. The key is that it has 5 layers. */
    background-image:
            linear-gradient(to top, rgba(0,0,0,0) 0%, black 100%), /* 1. Color overlay */
            linear-gradient(45deg, #808080 25%, transparent 25%),  /* 2. Checkerboard */
            linear-gradient(-45deg, #808080 25%, transparent 25%), /* 3. Checkerboard */
            linear-gradient(45deg, transparent 75%, #808080 75%),  /* 4. Checkerboard */
            linear-gradient(-45deg, transparent 75%, #808080 75%); /* 5. Checkerboard */

    /* --- FIX: Define size and position for EACH of the 5 layers --- */
    background-size: 100% 100%, 16px 16px, 16px 16px, 16px 16px, 16px 16px;
    background-position: 0 0, 0 0, 0 8px, 8px -8px, -8px 0px;
}
.color-picker-hue-slider .color-picker-selector,
.color-picker-alpha-slider .color-picker-selector {
    position: absolute;
    left: -4px;
    width: 27px;
    height: 5px;
    background-color: transparent;
    border: 2px solid white;
    transform: translateY(-50%);
    pointer-events: none;
    box-shadow: 0 0 2px rgba(0,0,0,0.8);
}
.color-picker-side {
    width: 100px;
    display: flex;
    flex-direction: column;
    gap: 1rem;
}
.color-picker-previews {
    display: flex;
    width: 100%;
    height: 50px;
}
.color-picker-preview {
    width: 50%;
    height: 100%;
    border: 1px solid #555;
}
#color-picker-preview-new { border-top-left-radius: 5px; border-bottom-left-radius: 5px; }
#color-picker-preview-current { border-top-right-radius: 5px; border-bottom-right-radius: 5px; }

.color-picker-inputs { display: flex; flex-direction: column; gap: 0.8rem; }
.color-picker-inputs-grid { display: grid; grid-template-columns: auto 1fr auto; gap: 0.5rem; align-items: center; }
.color-picker-inputs-grid label { color: #aaa; }
.color-picker-inputs-grid input { width: 100%; text-align: center; }

.color-picker-bottom-inputs {
    display: flex;
    gap: 1rem;
    align-items: center;
}
.color-picker-bottom-inputs .color-input-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    width: 80px;
}
.color-picker-bottom-inputs .color-input-group label {
    color: #aaa;
}
.color-picker-bottom-inputs .color-input-group input {
    flex-grow: 1;
}

.hex-rgb-group {
    width: 110px !important;
}

.hex-rgba-group {
    width: 130px !important;
}

/* --- Custom Gradient Editor Styles --- */
#gradient-editor-dialog .dialog-content { width: 600px; }
.gradient-editor-body {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    min-height: 185px;
}
.gradient-bar-container {
    position: relative;
    padding: 0 15px; /* Space for end stops */
}
.gradient-bar-bg {
    width: 100%;
    height: 30px;
    border: 1px solid #555;
    background-image: linear-gradient(45deg, #808080 25%, transparent 25%), linear-gradient(-45deg, #808080 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #808080 75%), linear-gradient(-45deg, transparent 75%, #808080 75%);
    background-size: 20px 20px;
    background-position: 0 0, 0 10px, 10px -10px, -10px 0;
}
.gradient-bar {
    width: 100%;
    height: 100%;
}
.gradient-stops-area {
    position: absolute;
    top: 0;
    left: 15px;
    right: 15px;
    bottom: -30px; /* Extend below for color stops */
    cursor: crosshair;
}
.gradient-color-stop {
    position: absolute;
    bottom: 5px; /* Position it above the bottom of the area */
    width: 12px;
    height: 12px;
    border: 1px solid #888;
    background-clip: content-box;
    transform: translateX(-50%) rotate(45deg);
    cursor: grab;
    box-shadow: 0 0 3px rgba(0,0,0,0.5);
    z-index: 10;
}
.gradient-color-stop.active {
    border-color: #fff;
    border-width: 2px;
}
.gradient-midpoint {
    position: absolute;
    bottom: 23px;
    width: 10px;
    height: 10px;
    border: 1px solid #888;
    background-color: #ddd;
    transform: translateX(-50%) rotate(45deg);
    cursor: ew-resize;
    box-shadow: 0 0 2px rgba(0,0,0,0.5);
    z-index: 5;
}
.gradient-midpoint:hover, .gradient-midpoint.active {
    border-color: #fff;
    background-color: #fff;
}
.gradient-stop-details, .gradient-midpoint-details {
    margin-top: 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.gradient-midpoint-details {
    justify-content: center;
}
.gradient-stop-details .form-group, .gradient-midpoint-details .form-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.gradient-stop-details label, .gradient-midpoint-details label { margin: 0; }
.gradient-stop-details input[type=number], .gradient-midpoint-details input[type=number] { width: 70px; }
.gradient-stop-details .color-swatch { width: 50px; height: 30px; }
.gradient-stop-details .color-swatch-inner { height: 100%; }

/* --- Properties Panel Image Properties --- */
.image-source-container {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.image-preview-box {
    width: 60px;
    height: 60px;
    flex-shrink: 0;
    border: 1px solid #555;
    border-radius: 4px;
    background-color: #333;
    background-repeat: no-repeat;
    background-size: contain;
    background-position: center;
}

.image-source-container .file-input-btn {
    flex-grow: 1;
}

/* --- Lyrics Editor Dialog --- */
#lyrics-editor-dialog .dialog-content {
    font-size: 1rem;
}

#lyrics-editor-dialog .dialog-body {
    display: flex;
    flex-direction: column;
    padding: 1rem;
    gap: 1rem;
}

.measure-manager {
    display: flex;
    align-items: stretch;
    min-height: 175px;
    padding: 0.5rem;
    border: 1px solid #555;
    border-radius: 5px;
    background-color: #2d2d2d;
    overflow: auto;
    max-height: calc(100vh - 300px);
    position: relative; /* <<< FIX: This is the required change */
}

.measures-container {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.measures-container::after {
    content: "";
    display: block;
    flex: 0 0 1px;
    width: 1px;
    height: 1px;
}

#events-editor-dialog .measures-container {
    align-items: stretch;
    height: 100%;
}

.measure-box {
    min-width: 100px;
    min-height: 175px;
    height: calc(100% - 2px);
    background-color: #3c3c3c;
    border: 1px solid #555;
    border-radius: 4px;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    position: relative;
    transition: opacity 0.2s ease-in-out;
}

/* ADDED: Styles for foreign measures in editors */
.measure-box.foreign-measure {
    background-color: #313131; /* A slightly different shade */
    border-color: #4a4a4a;
}

.measure-box.foreign-measure .measure-header {
    background-color: #3c3c3c;
    cursor: not-allowed; /* Indicate it can't be dragged */
}

/* Hide action buttons on foreign measures */
.measure-box.foreign-measure .delete-measure-btn,
.measure-box.foreign-measure .duplicate-measure-btn,
.measure-box.foreign-measure .copy-measure-btn,
.measure-box.foreign-measure .paste-measure-btn {
    display: none;
}


#events-editor-dialog .measure-box {
    height: auto;
}

.measure-header {
    padding: 0.5rem;
    font-weight: bold;
    color: #ccc;
    border-bottom: 1px solid #555;
    background-color: #4a4a4a;
    text-align: center;
    cursor: grab;
}

.measure-header:active {
    cursor: grabbing;
}

.measure-global-number {
    color: #24d7ff;
}

.measure-content {
    flex-grow: 1;
    padding: 0.5rem;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    gap: 4px;
}

.measure-time-signature {
    right: 15px;
    position: absolute;
    font-size: 0.7rem;
}

#events-editor-dialog .measure-content {
    align-items: flex-start;
}

.measure-box.dragging {
    opacity: 0.4;
    border-style: dashed;
}

.measure-box.drag-over-left::before,
.measure-box.drag-over-right::after {
    content: '';
    position: absolute;
    top: 4px;
    bottom: 4px;
    width: 4px;
    background-color: #007bff;
    border-radius: 2px;
    z-index: 1;
}

.measure-box.drag-over-left::before {
    left: -8px;
}

.measure-box.drag-over-right::after {
    right: -8px;
}

/* Style for the measure count in Orchestra editor */
.measure-count-display {
    font-size: 2rem;
    color: #888;
    font-weight: bold;
    pointer-events: none; /* Make sure it doesn't interfere with drag/drop */
}

.add-note-btn {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px dashed #777;
    background-color: rgba(255, 255, 255, 0.1);
    color: #ccc;
    font-size: 2rem;
    line-height: 36px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.add-note-btn:hover {
    background-color: rgba(255, 255, 255, 0.2);
    border-color: #aaa;
}

.tool-palette {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    padding: 0.5rem;
    border: 1px solid #555;
    border-radius: 5px;
    background-color: #2d2d2d;
    flex-shrink: 0;
}

.tool-row {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
}

.tool-btn {
    width: 50px;
    height: 50px;
    background-color: #4a4a4a;
    border: 2px solid #555;
    border-radius: 5px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.2s ease;
}

.tool-btn:hover {
    background-color: #5a5a5a;
    border-color: #777;
}

.tool-btn.active {
    border-color: #007bff;
    background-color: #5a5a5a;
}

.tool-btn img {
    width: 32px;
    height: 32px;
}

/* Style for the tool button being dragged */
.tool-btn.dragging {
    opacity: 0.4;
    border-style: dashed;
}

/* When dragging a note, make measure boxes receptive */
#lyrics-editor-dialog.is-dragging-note .measure-content {
    transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
}

/* Style for a valid drop target measure */
.measure-content.drag-over {
    background-color: rgba(0, 123, 255, 0.2);
    border-color: #007bff;
    border-width: 2px;
}

/* Style for an invalid drop target measure */
.measure-content.drag-invalid {
    background-color: rgba(232, 17, 35, 0.2) !important;
    border-color: #e81123;
    border-width: 2px;
    cursor: not-allowed;
}

.note-element {
    position: relative;
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 65px;
    padding: 0 2px;
    cursor: pointer;
    border-radius: 3px;
    transition: outline 0.1s ease-in-out;
    outline: 2px solid transparent;
    gap: 4px;
}

#events-editor-dialog .note-element {
    justify-content: flex-start;
}

.note-element img {
    height: 40px;
    pointer-events: none;
}

.note-text-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 4px;
}

.note-text {
    margin-top: 0;
    font-size: 0.9rem;
    color: #ccc;
    padding: 2px 4px;
    min-width: 20px;
    text-align: center;
    border-radius: 3px;
}

.note-text-connector {
    font-size: 0.9rem;
    color: #ccc;
    padding: 2px 0; /* Add some padding to match text height */
}

.note-text-input {
    margin-top: 4px;
    font-size: 0.9rem;
    color: #fff;
    background-color: #5a5a5a;
    border: 1px solid #007bff;
    border-radius: 3px;
    padding: 1px 3px;
    min-width: 20px;
    text-align: center;
    outline: none;
    box-sizing: border-box;
}

.note-text-sizer {
    position: absolute;
    top: -9999px;
    left: -9999px;
    visibility: hidden;
    white-space: pre;
    font-size: 0.9rem;
    padding: 1px 5px;
    border: 1px solid transparent;
    box-sizing: border-box;
}

/* Blue line drop indicators */
.note-element.drop-indicator-before::before,
.note-element.drop-indicator-after::after {
    content: '';
    position: absolute;
    top: 2px;
    bottom: 2px;
    width: 3px;
    background-color: #007bff;
    border-radius: 2px;
    z-index: 1;
}

.note-element.drop-indicator-before::before {
    left: -5px;
}

.note-element.drop-indicator-after::after {
    right: -5px;
}

#lyrics-editor-dialog .dialog-body {
    justify-content: space-between;
}

.lyrics-editor-bottom {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    width: 100%;
    margin-top: 1rem;
}

#le-tool-palette {
    justify-content: flex-start;
}

#le-action-palette {
    justify-content: flex-end;
}

.tool-btn:disabled {
    background-color: #3c3c3c;
    border-color: #444;
    cursor: not-allowed;
    opacity: 0.5;
}

.note-element.selected {
    outline: 2px solid #007bff;
    background-color: rgba(0, 123, 255, 0.2);
}

/* --- Lyrics Editor Measure Delete Button --- */
.delete-measure-btn, .duplicate-measure-btn, .copy-measure-btn, .paste-measure-btn {
    position: absolute;
    top: -8px;
    width: 22px;
    height: 22px;
    color: white;
    border: 1px solid #555555;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    opacity: 0;
    transform: scale(0.8);
    transition: opacity 0.2s ease, transform 0.2s ease;
    z-index: 10;
    padding: 0;
}

.delete-measure-btn {
    right: -8px;
    background-color: #cc3333;
}

.duplicate-measure-btn {
    right: 20px;
    background-color: #007bff;
}

.copy-measure-btn {
    right: 20px;
    background-color: #007bff; /* Blue for copy */
}

.paste-measure-btn {
    right: -8px;
    background-color: #55a521; /* Green for paste */
}

.paste-measure-btn:disabled {
    background-color: #4a4a4a;
    cursor: not-allowed;
}

.delete-measure-btn img, .duplicate-measure-btn img, .copy-measure-btn img, .paste-measure-btn img {
    width: 12px;
    height: 12px;
}

.measure-box:hover .delete-measure-btn,
.measure-box:hover .duplicate-measure-btn,
.measure-box:hover .copy-measure-btn,
.measure-box:hover .paste-measure-btn {
    opacity: 1;
    transform: scale(1);
}

.delete-measure-btn:hover,
.paste-measure-btn:hover:not(:disabled) {
    background-color: #e81123;
    transform: scale(1.1);
}

.duplicate-measure-btn:hover,
.copy-measure-btn:hover {
    background-color: #0056b3;
    transform: scale(1.1);
}

.paste-measure-btn:hover:not(:disabled) {
    background-color: #6fcf3f;
}

.lyrics-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    color: #888;
    font-style: italic;
    padding: 1rem;
    box-sizing: border-box;
}

.lyrics-render-container {
    display: flex;
    flex-wrap: wrap;
    align-items: baseline;
    align-content: flex-start;
    padding: 10px;
    width: 100%;
    height: 100%;
    box-sizing: border-box;
}

.lyrics-render-word {
    /* Individual words will wrap naturally */
}

/* --- Temporary Highlight for Panel Cross-Interaction --- */
.layer-item > .layer-content.temp-highlight {
    background-color: rgba(3, 136, 0, 0.6); /* Green highlight color */
    transition: background-color 0.2s ease-in-out;
}

/* --- Z-INDEX HIERARCHY FOR DIALOGS --- */
#orchestra-editor-dialog,
#lyrics-editor-dialog,
#events-editor-dialog {
    z-index: 1010;
}

#confirmation-dialog,
#add-measure-dialog,
#add-orchestra-measure-dialog,
#properties-dialog {
    z-index: 1020;
}

#alert-dialog {
    z-index: 1110;
}

#edit-event-property-dialog {
    z-index: 1030;
}
/* ADDED: Easing dialog z-index */
#easing-editor-dialog {
    z-index: 1035;
}

#gradient-editor-dialog {
    z-index: 1040;
}

#color-picker-dialog,
#opaque-color-picker-dialog {
    z-index: 1050;
}

/* ADDED: Font Picker dialog z-index */
#font-picker-dialog {
    z-index: 1060;
}

/* MODIFIED: Swapped z-index with alert dialog */
#loading-dialog {
    z-index: 1100;
}
#loading-dialog .dialog-content {
    padding: 2rem 3rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
}
.loading-text {
    font-size: 1.1rem;
    font-weight: 500;
}


/* --- Events Editor Note Event Styles --- */
.note-toggle-events-btn {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 1px solid #777;
    background-color: #4a4a4a;
    color: #ccc;
    font-size: 1.2rem;
    line-height: 18px;
    cursor: pointer;
    transition: all 0.2s ease;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
}

.note-toggle-events-btn:hover {
    background-color: #5a5a5a;
    border-color: #aaa;
}

.note-events-container {
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px solid #555;
    width: 100%;
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 0.5rem;
    align-items: center;
}

.note-events-placeholder {
    font-size: 0.8rem;
    color: #888;
    text-align: center;
    font-style: italic;
    grid-column: 1 / -1; /* Make placeholder span all columns */
}

.note-event-prop-label {
    color: #ccc;
    white-space: nowrap;
    text-align: left;
    font-size: 0.8rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 2px;
}

.note-event-prop-label .prop-group-name {
    font-size: 0.7rem;
    color: #888;
    font-style: italic;
}

.note-event-prop-label .prop-name {
    font-weight: bold;
}

.note-event-value-preview {
    background-color: #2d2d2d;
    border: 1px solid #555;
    border-radius: 4px;
    padding: 4px 4px;
    font-size: 0.8rem;
    color: #fff;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    height: 20px;
    min-width: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.note-event-value-preview:hover {
    border-color: #777;
    background-color: #3c3c3c;
}

.note-event-value-preview i {
    color: #888;
    font-style: italic;
}

.note-event-value-preview.is-overridden {
    border: 1px solid #24d7ff;
}

.value-preview-color-swatch {
    width: 100%;
    height: 18px;
    border: 1px solid #444;
    border-radius: 3px;
    /* Checkerboard background for transparency */
    background-image: linear-gradient(45deg, #808080 25%, transparent 25%), linear-gradient(-45deg, #808080 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #808080 75%), linear-gradient(-45deg, transparent 75%, #808080 75%);
    background-size: 10px 10px;
    background-position: 0 0, 0 5px, 5px -5px, -5px 0px;
}


/* --- NEW: Dashed Connector Line for Events (Dynamic) --- */

/* Add margin ONLY to adjacent notes that need a connector, not globally */
.note-element.needs-spacing-for-connector {
    margin-right: 24px;
}

/* Style for the dynamically created connector line DIVs */
.event-connector-line {
    position: absolute;
    height: 2px;
    /* --- CHANGE: Use radial gradient for a dotted line effect --- */
    background-image: radial-gradient(circle, #24d7ff 1px, transparent 1px);
    background-size: 4px 3px;
    background-repeat: repeat-x;
    transform-origin: 0 50%; /* Rotate from the start of the line */
    pointer-events: none; /* Make sure lines don't block clicks */
}

/* --- NEW: Easing function button on event connectors --- */
.event-easing-btn {
    position: absolute;
    width: 20px;
    height: 20px;
    background-color: #3c3c3c;
    border: 1px solid #24d7ff;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transform: translate(-50%, -50%);
    z-index: 2;
    padding: 2px;
    transition: background-color 0.2s ease;
}
.event-easing-btn:hover {
    background-color: #5a5a5a;
}
.event-easing-btn img {
    width: 12px;
    height: 12px;
}

/* --- NEW: Style for the top part of the note element --- */
.note-element-top {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px; /* Space between button and icon */
}

/* --- NEW: Style for the disabled events symbol --- */
.note-events-disabled-symbol {
    grid-column: 1 / -1;
    text-align: center;
    color: #666;
    font-size: 1.5rem;
    line-height: 1;
}


/* --- Properties Dialog Styles --- */
#properties-dialog .dialog-body {
    max-height: 60vh;
    overflow-y: auto;
    padding: 0;
}

#properties-dialog .prop-group {
    border-bottom: 1px solid #555;
}
#properties-dialog .prop-group:last-child {
    border-bottom: none;
}

#properties-dialog .prop-group-header {
    padding: 0.8rem 1rem;
    cursor: pointer;
    transition: background-color 0.2s;
}

#properties-dialog .prop-group-header:hover {
    background-color: #4a4a4a;
}

#properties-dialog .prop-group-body {
    padding: 1rem;
    background-color: #333;
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
}

#total-props-display {
    display: flex;
    justify-content: center;
    align-items: center;
}

.prop-dialog-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.prop-dialog-item:hover {
    background-color: #4a4a4a;
}

/* --- NEW: Styling for selected property text --- */
.prop-dialog-item:has(.remove-prop-btn) > span {
    color: #00aaff;
    font-weight: bold;
}

.prop-dialog-item:has(.add-prop-btn) > span {
    color: inherit; /* Default color */
    font-weight: normal;
}


.prop-dialog-item button {
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px;
    display: flex;
    align-items: center;
    border-radius: 3px;
    transition: background-color 0.2s;
    pointer-events: none; /* Make the parent item handle the click */
}

.prop-dialog-item button img {
    width: 18px;
    height: 18px;
}

.prop-dialog-item button:hover {
    background-color: #555;
}
.prop-dialog-item button img {
    width: 18px;
    height: 18px;
}

#ee-action-palette .tool-btn img {
    width: 24px;
    height: 24px;
}

#ee-action-palette button[title="Select Event Properties"] {
    font-size: 1.5rem;
}

/* --- NEW: Easing Editor Dialog Styles --- */
.easing-options-container {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
}
.easing-option-btn {
    padding: 1rem;
    background-color: #4a4a4a;
    border: 2px solid #555;
    border-radius: 5px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.2s ease;
}
.easing-option-btn:hover:not(:disabled) {
    background-color: #5a5a5a;
    border-color: #777;
}
.easing-option-btn.active {
    border-color: #007bff !important;
    background-color: #5a5a5a;
}
.easing-option-btn:disabled {
    background-color: #3c3c3c;
    border-color: #444;
    cursor: not-allowed;
    opacity: 0.5;
}
.easing-option-btn img {
    width: 48px;
    height: 48px;
}

/* --- NEW: Font Picker Dialog Styles --- */
#font-picker-dialog .dialog-content {
    width: 500px;
}
#font-picker-dialog .dialog-body {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    padding-bottom: 0;
}
#font-picker-list-container {
    height: 350px;
    overflow-y: auto;
    border: 1px solid #555;
    border-radius: 5px;
    background-color: #2d2d2d;
}
#font-picker-list {
    list-style: none;
    padding: 0;
    margin: 0;
}
.font-list-item {
    padding: 0.7rem 1rem;
    cursor: pointer;
    border-bottom: 1px solid #444;
    transition: background-color 0.2s ease;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.font-list-item-name {
    flex-grow: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.font-list-item-preview {
    flex-shrink: 0;
    margin-left: 1rem;
    font-size: 1.1rem;
    color: #a0a0a0;
}
.font-list-item:last-child {
    border-bottom: none;
}
.font-list-item:hover {
    background-color: #4a4a4a;
}
.font-list-item.selected {
    background-color: #007bff;
    color: white;
}
.font-list-item.selected .font-list-item-preview {
    color: white;
}


/* --- Playback Mode UI Disabling --- */

/* Disable panels, their handles, and the page manager with visual feedback */
.elements-panel,
.events-panel,
.properties-panel,
.layers-panel,
.drawer-handle,
.page-manager {
    position: relative;
    transition: opacity 0.3s ease-in-out, width 0.3s ease-in-out, height 0.3s ease-in-out, background-color 0.2s;
}

/* Apply visual feedback when disabled */
body.is-playing .elements-panel,
body.is-playing .events-panel,
body.is-playing .properties-panel,
body.is-playing .layers-panel,
body.is-playing .drawer-handle,
body.is-playing .page-manager {
    user-select: none;
    opacity: 0.6;
}

/* Transparent overlay to block interaction and show "not-allowed" cursor */
body.is-playing .elements-panel::before,
body.is-playing .events-panel::before,
body.is-playing .properties-panel::before,
body.is-playing .layers-panel::before,
body.is-playing .drawer-handle::before,
body.is-playing .page-manager::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 100;
    cursor: not-allowed;
}

/* Disable interaction with slides but keep appearance unchanged */
body.is-playing .slide-wrapper {
    pointer-events: none;
}

/* Styles for staging container */
#staging-page-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1; /* Sits below the main container */
    pointer-events: none; /* Allows clicks to pass through */
}

#staging-page-container .slide-wrapper {
    pointer-events: all; /* The page itself should be interactive */
}

#page-container {
    position: relative; /* Ensure this is relative for z-index stacking */
    z-index: 2; /* Sits on top of the staging container */
}

/* --- Lyrics Editor Measure Delete Button --- */
.delete-measure-btn, .duplicate-measure-btn, .copy-measure-btn, .paste-measure-btn {
    position: absolute;
    top: -8px;
    width: 22px;
    height: 22px;
    color: white;
    border: 1px solid #555555;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    opacity: 0;
    transform: scale(0.8);
    transition: opacity 0.2s ease, transform 0.2s ease;
    z-index: 10;
    padding: 0;
}

/* ADDED: Styles for the line break button in the lyrics editor */
.note-element .line-break-btn {
    display: none; /* Hidden by default */
    position: absolute;
    bottom: -28px;
    left: 50%;
    transform: translateX(-50%);
    width: 24px;
    height: 24px;
    padding: 4px;
    border-radius: 4px;
    border: 1px solid #555;
    background-color: #4a4a4a;
    cursor: pointer;
    transition: all 0.2s ease;
}

.note-element.selected .line-break-btn {
    display: block; /* Show only when the note is selected */
}

.note-element .line-break-btn:hover {
    background-color: #5a5a5a;
    border-color: #777;
}

.line-break-btn img {
    width: 100%;
    height: 100%;
}

.line-break-btn .line-break-icon-active {
    display: none;
}

.line-break-btn.active .line-break-icon-default {
    display: none;
}

.line-break-btn.active .line-break-icon-active {
    display: block;
}

.note-text.has-line-break {
    color: #24d7ff; /* Blue indicator for active line break */
    font-weight: bold;
}


.delete-measure-btn {
    right: -8px;
    background-color: #cc3333;
}


/* --- Font Picker Button Styling --- */
.font-picker-button {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 0.6rem 0.8rem;
    background-color: #333;
    border: 1px solid #555;
    border-radius: 4px;
    color: #fff;
    cursor: pointer;
    transition: all 0.2s ease;
    box-sizing: border-box;
}

.font-picker-button:hover {
    background-color: #444;
    border-color: #777;
}

.font-picker-button span {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-size: 0.9rem;
    margin-right: 10px;
}

/* This fixes the 800px image issue */
.font-picker-button img {
    width: 16px;
    height: 16px;
    flex-shrink: 0; /* Prevents the icon from being squished */
    filter: brightness(0.8); /* Optional: tones down the icon to match the UI */
}

